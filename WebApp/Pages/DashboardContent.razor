@inject AttendanceService AttendanceService
@inject NavigationManager nm

<div class="wrapper" style="font-family: 'Arial', sans-serif;">
    <!-- Dashboard Header -->
    <div class="container-fluid">
        <div class="row g-4">
            <div class="col-lg-3 col-md-6 col-12">
                <div class="small-box text-white text-center p-3 shadow-sm" style="min-width: 10rem; background-color: #4CAF50; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    <div class="inner">
                        <h3 style="font-size: 2rem;">120</h3>
                        <p>Total Students</p>
                    </div>
                    <div class="icon my-3">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                    <a href="#" class="small-box-footer text-white" style="font-size: 1.1rem;">View Students <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-12">
                <div class="small-box bg-success text-white text-center p-3 shadow-sm" style="min-width: 10rem; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    <div class="inner">
                        <h3 style="font-size: 2rem;">95%</h3>
                        <p>Attendance Today</p>
                    </div>
                    <div class="icon my-3">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                    <a href="#" class="small-box-footer text-white" style="font-size: 1.1rem;">More Details <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-12">
                <div class="small-box bg-warning text-white text-center p-3 shadow-sm" style="min-width: 10rem; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    <div class="inner">
                        <h3 style="font-size: 2rem;">12</h3>
                        <p>Absent Students</p>
                    </div>
                    <div class="icon my-3">
                        <i class="fas fa-user-times fa-2x"></i>
                    </div>
                    <a href="#" class="small-box-footer text-white" style="font-size: 1.1rem;">Check Absent List <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-12">
                <div class="small-box bg-danger text-white text-center p-3 shadow-sm" style="min-width: 10rem; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    <div class="inner">
                        <h3 style="font-size: 2rem;">5</h3>
                        <p>Late Arrivals</p>
                    </div>
                    <div class="icon my-3">
                        <i class="fas fa-clock fa-2x"></i>
                    </div>
                    <a href="#" class="small-box-footer text-white" style="font-size: 1.1rem;">View Details <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <div class="row g-4">
            <!-- Left Section -->
            <section class="col-lg-7">
                <!-- Attendance Chart -->
                <div class="card shadow-sm mb-4" style="border-radius: 12px;">
                    <div class="card-header bg-primary text-white fw-bold">
                        <h3 class="card-title m-0">
                            <i class="fas fa-chart-line me-2"></i> Monthly Attendance Overview
                        </h3>
                    </div>
                    <div class="card-body p-4">
                        @if (InstructorDetails != null)
                        {
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Designation</th>
                                        <th>Department</th>
                                        <th>Faculty Type</th>
                                        <th>Total Regular Classes</th>
                                        <th>Total Makeup Classes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr @onclick="NavigateToTeacherDashboard" style="cursor: pointer;">
                                        <td>@InstructorDetails.Name</td>
                                        <td>@InstructorDetails.Designation</td>
                                        <td>@InstructorDetails.Department</td>
                                        <td>@InstructorDetails.FacultyType</td>
                                        <td>@InstructorDetails.TotalRegularClasses</td>
                                        <td>@InstructorDetails.TotalMakeupClasses</td>
                                    </tr>
                                </tbody>
                            </table>
                        }
                        else
                        {
                            <p>No instructor details available</p>
                        }
                    </div>
                </div>

                <!-- Recent Attendance -->
                <div class="card shadow-sm mb-4" style="border-radius: 12px;">
                    <div class="card-header bg-info text-white fw-bold">
                        <h3 class="card-title m-0">Recent Attendance Records</h3>
                    </div>
                    <div class="card-body p-4">
                        <table class="table table-striped table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th>Subject</th>
                                    <th>Teacher</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (AttendanceRecords != null)
                                {
                                    @foreach (var record in AttendanceRecords)
                                    {
                                        <tr>
                                            <td>@record.Subject</td>
                                            <td>@record.Teacher</td>
                                            <td>@record.Status</td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="3" class="text-center">No attendance records available</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

@code {
    private Instructor? InstructorDetails { get; set; }
    private List<AttendanceRecord>? AttendanceRecords { get; set; }

    private async Task LoadDataAsync()
    {
        InstructorDetails = await AttendanceService.GetInstructorDetailsAsync();
        AttendanceRecords = await AttendanceService.GetAttendanceRecordsAsync();
    }

    private void NavigateToTeacherDashboard()
    {
        nm.NavigateTo("/TeacherDashboard");
    }

    protected override async Task OnInitializedAsync()
    {
        await LoadDataAsync();
    }
}
